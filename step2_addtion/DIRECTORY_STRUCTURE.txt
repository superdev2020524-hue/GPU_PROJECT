================================================================================
           vGPU STUB MMIO COMMUNICATION - DIRECTORY STRUCTURE
================================================================================

Project Root: /home/david/Downloads/gpu/step2_addtion/

================================================================================
CURRENT STATE (Files that exist now)
================================================================================

step2_addtion/
â”œâ”€â”€ core.txt                           [EXISTS] Original plan document
â”œâ”€â”€ README.md                          [EXISTS] Project overview (start here)
â”œâ”€â”€ READY_TO_PROCEED.md                [EXISTS] Next steps and decision point
â”œâ”€â”€ IMPLEMENTATION_ROADMAP.md          [EXISTS] Complete project plan
â”œâ”€â”€ REGISTER_MAP_SPEC.md               [EXISTS] MMIO register specification
â”œâ”€â”€ VGPU_STUB_CHANGES.md               [EXISTS] Code changes needed
â””â”€â”€ DIRECTORY_STRUCTURE.txt            [EXISTS] This file

Status: âœ… All planning documentation complete
        â³ Waiting for implementation decision

================================================================================
PLANNED STRUCTURE (Will be created during implementation)
================================================================================

step2_addtion/
â”‚
â”œâ”€â”€ ğŸ“„ Documentation Files (EXISTING)
â”‚   â”œâ”€â”€ README.md                      â† Start here!
â”‚   â”œâ”€â”€ READY_TO_PROCEED.md            â† Decision point
â”‚   â”œâ”€â”€ IMPLEMENTATION_ROADMAP.md      â† Full project plan
â”‚   â”œâ”€â”€ REGISTER_MAP_SPEC.md           â† Technical spec
â”‚   â”œâ”€â”€ VGPU_STUB_CHANGES.md           â† Code changes
â”‚   â”œâ”€â”€ DIRECTORY_STRUCTURE.txt        â† This file
â”‚   â””â”€â”€ core.txt                       â† Original plan
â”‚
â”œâ”€â”€ ğŸ”§ vgpu_stub_enhanced/ [TO CREATE]
â”‚   â”‚   Enhanced QEMU device source code
â”‚   â”‚
â”‚   â”œâ”€â”€ vgpu-stub.c                    â† Enhanced device (main file)
â”‚   â”œâ”€â”€ vgpu-stub.h                    â† Header file
â”‚   â”œâ”€â”€ vgpu-protocol.h                â† Shared protocol definitions
â”‚   â”œâ”€â”€ vgpu-errors.h                  â† Error code definitions
â”‚   â”‚
â”‚   â”œâ”€â”€ patches/
â”‚   â”‚   â”œâ”€â”€ 0001-add-vgpu-stub.patch   â† Patch for QEMU tree
â”‚   â”‚   â”œâ”€â”€ qemu-spec.patch            â† Patch for RPM spec
â”‚   â”‚   â””â”€â”€ apply-patches.sh           â† Script to apply patches
â”‚   â”‚
â”‚   â”œâ”€â”€ build/
â”‚   â”‚   â”œâ”€â”€ build.sh                   â† Build QEMU with device
â”‚   â”‚   â”œâ”€â”€ install.sh                 â† Install RPM
â”‚   â”‚   â””â”€â”€ rollback.sh                â† Restore original QEMU
â”‚   â”‚
â”‚   â””â”€â”€ README.md                      â† Build instructions
â”‚
â”œâ”€â”€ ğŸ‘¥ guest_client/ [TO CREATE]
â”‚   â”‚   Guest VM client library and utilities
â”‚   â”‚
â”‚   â”œâ”€â”€ Library Source
â”‚   â”‚   â”œâ”€â”€ vgpu_mmio_client.c         â† Main client library
â”‚   â”‚   â”œâ”€â”€ vgpu_mmio_client.h         â† Public API header
â”‚   â”‚   â”œâ”€â”€ vgpu_internal.h            â† Internal definitions
â”‚   â”‚   â””â”€â”€ vgpu_protocol.h            â† Protocol structs (symlink)
â”‚   â”‚
â”‚   â”œâ”€â”€ Test Programs
â”‚   â”‚   â”œâ”€â”€ test_registers.c           â† Test: read all registers
â”‚   â”‚   â”œâ”€â”€ test_doorbell.c            â† Test: ring doorbell
â”‚   â”‚   â”œâ”€â”€ test_request_response.c    â† Test: simple request/response
â”‚   â”‚   â”œâ”€â”€ test_buffers.c             â† Test: buffer read/write
â”‚   â”‚   â”œâ”€â”€ test_errors.c              â† Test: error handling
â”‚   â”‚   â””â”€â”€ test_stress.c              â† Test: stress/load testing
â”‚   â”‚
â”‚   â”œâ”€â”€ Example Programs
â”‚   â”‚   â”œâ”€â”€ example_nop.c              â† Example: NOP request
â”‚   â”‚   â”œâ”€â”€ example_cuda_kernel.c      â† Example: CUDA execution
â”‚   â”‚   â”œâ”€â”€ example_async.c            â† Example: async requests
â”‚   â”‚   â””â”€â”€ example_multi_request.c    â† Example: multiple requests
â”‚   â”‚
â”‚   â”œâ”€â”€ Utilities
â”‚   â”‚   â”œâ”€â”€ vgpu_info.c                â† Utility: show device info
â”‚   â”‚   â”œâ”€â”€ vgpu_dump.c                â† Utility: dump registers
â”‚   â”‚   â”œâ”€â”€ vgpu_bench.c               â† Utility: benchmark performance
â”‚   â”‚   â””â”€â”€ vgpu_monitor.c             â† Utility: monitor device activity
â”‚   â”‚
â”‚   â”œâ”€â”€ Build System
â”‚   â”‚   â”œâ”€â”€ Makefile                   â† Build all programs
â”‚   â”‚   â”œâ”€â”€ Makefile.lib               â† Build library only
â”‚   â”‚   â””â”€â”€ install.sh                 â† Install to system
â”‚   â”‚
â”‚   â””â”€â”€ Documentation
â”‚       â”œâ”€â”€ README.md                  â† Client library guide
â”‚       â”œâ”€â”€ API_REFERENCE.md           â† API documentation
â”‚       â”œâ”€â”€ EXAMPLES.md                â† Example usage
â”‚       â””â”€â”€ TROUBLESHOOTING.md         â† Common issues
â”‚
â”œâ”€â”€ ğŸ–¥ï¸ host_mediator/ [TO CREATE]
â”‚   â”‚   Host-side mediator integration
â”‚   â”‚
â”‚   â”œâ”€â”€ Socket Interface
â”‚   â”‚   â”œâ”€â”€ socket_server.py           â† Socket server implementation
â”‚   â”‚   â”œâ”€â”€ socket_adapter.py          â† Adapter for existing mediator
â”‚   â”‚   â”œâ”€â”€ connection_manager.py      â† Manage multiple VM connections
â”‚   â”‚   â””â”€â”€ protocol_parser.py         â† Binary protocol parser
â”‚   â”‚
â”‚   â”œâ”€â”€ Protocol Handling
â”‚   â”‚   â”œâ”€â”€ request_handler.py         â† Process incoming requests
â”‚   â”‚   â”œâ”€â”€ response_builder.py        â† Build response packets
â”‚   â”‚   â”œâ”€â”€ error_handler.py           â† Error handling
â”‚   â”‚   â””â”€â”€ validation.py              â† Input validation
â”‚   â”‚
â”‚   â”œâ”€â”€ Integration
â”‚   â”‚   â”œâ”€â”€ mediator_interface.py      â† Interface to existing mediator
â”‚   â”‚   â”œâ”€â”€ cuda_executor.py           â† CUDA execution wrapper
â”‚   â”‚   â”œâ”€â”€ priority_queue.py          â† Priority queue implementation
â”‚   â”‚   â””â”€â”€ pool_manager.py            â† GPU pool management
â”‚   â”‚
â”‚   â”œâ”€â”€ Legacy Support
â”‚   â”‚   â”œâ”€â”€ nfs_adapter.py             â† Old NFS interface (for reference)
â”‚   â”‚   â””â”€â”€ migration_bridge.py        â† Support both NFS and MMIO
â”‚   â”‚
â”‚   â”œâ”€â”€ Configuration
â”‚   â”‚   â”œâ”€â”€ config.yaml                â† Configuration file
â”‚   â”‚   â”œâ”€â”€ pools.yaml                 â† Pool definitions
â”‚   â”‚   â””â”€â”€ logging.yaml               â† Logging configuration
â”‚   â”‚
â”‚   â”œâ”€â”€ Scripts
â”‚   â”‚   â”œâ”€â”€ start_mediator.sh          â† Start mediator service
â”‚   â”‚   â”œâ”€â”€ stop_mediator.sh           â† Stop mediator service
â”‚   â”‚   â”œâ”€â”€ status.sh                  â† Check mediator status
â”‚   â”‚   â””â”€â”€ monitor.sh                 â† Monitor mediator activity
â”‚   â”‚
â”‚   â””â”€â”€ Documentation
â”‚       â”œâ”€â”€ README.md                  â† Mediator integration guide
â”‚       â”œâ”€â”€ ARCHITECTURE.md            â† Architecture overview
â”‚       â”œâ”€â”€ PROTOCOL.md                â† Protocol details
â”‚       â””â”€â”€ MIGRATION.md               â† Migration from NFS
â”‚
â”œâ”€â”€ ğŸ§ª testing/ [TO CREATE]
â”‚   â”‚   Comprehensive testing suite
â”‚   â”‚
â”‚   â”œâ”€â”€ Unit Tests
â”‚   â”‚   â”œâ”€â”€ test_unit_registers.sh     â† Test individual registers
â”‚   â”‚   â”œâ”€â”€ test_unit_doorbell.sh      â† Test doorbell logic
â”‚   â”‚   â”œâ”€â”€ test_unit_buffers.sh       â† Test buffer operations
â”‚   â”‚   â””â”€â”€ test_unit_protocol.sh      â† Test protocol parsing
â”‚   â”‚
â”‚   â”œâ”€â”€ Integration Tests
â”‚   â”‚   â”œâ”€â”€ test_integration_basic.sh  â† Basic end-to-end test
â”‚   â”‚   â”œâ”€â”€ test_integration_cuda.sh   â† CUDA execution test
â”‚   â”‚   â”œâ”€â”€ test_integration_errors.sh â† Error handling test
â”‚   â”‚   â””â”€â”€ test_integration_stress.sh â† Stress test
â”‚   â”‚
â”‚   â”œâ”€â”€ System Tests
â”‚   â”‚   â”œâ”€â”€ test_multi_vm.sh           â† Multiple VMs test
â”‚   â”‚   â”œâ”€â”€ test_priority.sh           â† Priority scheduling test
â”‚   â”‚   â”œâ”€â”€ test_pools.sh              â† Pool assignment test
â”‚   â”‚   â””â”€â”€ test_failover.sh           â† Failure recovery test
â”‚   â”‚
â”‚   â”œâ”€â”€ Performance Tests
â”‚   â”‚   â”œâ”€â”€ benchmark_latency.sh       â† Measure latency
â”‚   â”‚   â”œâ”€â”€ benchmark_throughput.sh    â† Measure throughput
â”‚   â”‚   â”œâ”€â”€ benchmark_vs_nfs.sh        â† Compare to NFS
â”‚   â”‚   â””â”€â”€ benchmark_scaling.sh       â† Scalability test
â”‚   â”‚
â”‚   â”œâ”€â”€ Regression Tests
â”‚   â”‚   â”œâ”€â”€ test_regression_all.sh     â† Run all regression tests
â”‚   â”‚   â””â”€â”€ test_cases/                â† Test case definitions
â”‚   â”‚       â”œâ”€â”€ case001_basic.yaml
â”‚   â”‚       â”œâ”€â”€ case002_errors.yaml
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ Test Utilities
â”‚   â”‚   â”œâ”€â”€ test_framework.sh          â† Common test functions
â”‚   â”‚   â”œâ”€â”€ vm_manager.sh              â† VM lifecycle management
â”‚   â”‚   â”œâ”€â”€ result_parser.py           â† Parse test results
â”‚   â”‚   â””â”€â”€ report_generator.py        â† Generate test reports
â”‚   â”‚
â”‚   â”œâ”€â”€ Test Data
â”‚   â”‚   â”œâ”€â”€ requests/                  â† Sample request files
â”‚   â”‚   â”‚   â”œâ”€â”€ nop_request.bin
â”‚   â”‚   â”‚   â”œâ”€â”€ cuda_kernel.bin
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ responses/                 â† Expected response files
â”‚   â”‚       â”œâ”€â”€ nop_response.bin
â”‚   â”‚       â”œâ”€â”€ cuda_result.bin
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ Documentation
â”‚       â”œâ”€â”€ README.md                  â† Testing guide
â”‚       â”œâ”€â”€ TEST_PLAN.md               â† Complete test plan
â”‚       â”œâ”€â”€ TEST_RESULTS.md            â† Test results log
â”‚       â””â”€â”€ CONTINUOUS_INTEGRATION.md  â† CI/CD integration
â”‚
â”œâ”€â”€ ğŸ“š docs/ [TO CREATE]
â”‚   â”‚   Additional documentation
â”‚   â”‚
â”‚   â”œâ”€â”€ Technical Docs
â”‚   â”‚   â”œâ”€â”€ PROTOCOL_SPEC.md           â† Binary protocol specification
â”‚   â”‚   â”œâ”€â”€ REGISTER_REFERENCE.md      â† Register reference guide
â”‚   â”‚   â”œâ”€â”€ ERROR_CODES.md             â† Error code reference
â”‚   â”‚   â””â”€â”€ STATE_MACHINE.md           â† Device state machine
â”‚   â”‚
â”‚   â”œâ”€â”€ User Guides
â”‚   â”‚   â”œâ”€â”€ USER_GUIDE.md              â† End-user guide
â”‚   â”‚   â”œâ”€â”€ ADMIN_GUIDE.md             â† Administrator guide
â”‚   â”‚   â”œâ”€â”€ DEVELOPER_GUIDE.md         â† Developer guide
â”‚   â”‚   â””â”€â”€ API_GUIDE.md               â† API programming guide
â”‚   â”‚
â”‚   â”œâ”€â”€ Design Docs
â”‚   â”‚   â”œâ”€â”€ ARCHITECTURE.md            â† System architecture
â”‚   â”‚   â”œâ”€â”€ DESIGN_DECISIONS.md        â† Design rationale
â”‚   â”‚   â”œâ”€â”€ PERFORMANCE.md             â† Performance analysis
â”‚   â”‚   â””â”€â”€ SECURITY.md                â† Security considerations
â”‚   â”‚
â”‚   â”œâ”€â”€ Migration Docs
â”‚   â”‚   â”œâ”€â”€ MIGRATION_GUIDE.md         â† NFS to MMIO migration
â”‚   â”‚   â”œâ”€â”€ COMPATIBILITY.md           â† Backward compatibility
â”‚   â”‚   â””â”€â”€ ROLLBACK_PLAN.md           â† Rollback procedures
â”‚   â”‚
â”‚   â”œâ”€â”€ Diagrams
â”‚   â”‚   â”œâ”€â”€ architecture.png           â† Architecture diagram
â”‚   â”‚   â”œâ”€â”€ register_map.png           â† Register layout diagram
â”‚   â”‚   â”œâ”€â”€ sequence_diagram.png       â† Request/response flow
â”‚   â”‚   â””â”€â”€ state_machine.png          â† State machine diagram
â”‚   â”‚
â”‚   â””â”€â”€ Reference
â”‚       â”œâ”€â”€ CHANGELOG.md               â† Version change log
â”‚       â”œâ”€â”€ LICENSE.txt                â† License information
â”‚       â”œâ”€â”€ CONTRIBUTORS.md            â† Contributors list
â”‚       â””â”€â”€ REFERENCES.md              â† External references
â”‚
â”œâ”€â”€ ğŸ› ï¸ scripts/ [TO CREATE]
â”‚   â”‚   Automation and utility scripts
â”‚   â”‚
â”‚   â”œâ”€â”€ Build Scripts
â”‚   â”‚   â”œâ”€â”€ build_all.sh               â† Build everything
â”‚   â”‚   â”œâ”€â”€ build_qemu.sh              â† Build QEMU only
â”‚   â”‚   â”œâ”€â”€ build_client.sh            â† Build client library
â”‚   â”‚   â””â”€â”€ build_tests.sh             â† Build test suite
â”‚   â”‚
â”‚   â”œâ”€â”€ Deployment Scripts
â”‚   â”‚   â”œâ”€â”€ deploy_host.sh             â† Deploy host components
â”‚   â”‚   â”œâ”€â”€ deploy_guest.sh            â† Deploy guest components
â”‚   â”‚   â”œâ”€â”€ deploy_all.sh              â† Deploy everything
â”‚   â”‚   â””â”€â”€ configure_vm.sh            â† Configure VM for vGPU
â”‚   â”‚
â”‚   â”œâ”€â”€ Maintenance Scripts
â”‚   â”‚   â”œâ”€â”€ backup.sh                  â† Backup configuration
â”‚   â”‚   â”œâ”€â”€ restore.sh                 â† Restore from backup
â”‚   â”‚   â”œâ”€â”€ cleanup.sh                 â† Clean up temporary files
â”‚   â”‚   â””â”€â”€ verify.sh                  â† Verify installation
â”‚   â”‚
â”‚   â”œâ”€â”€ Monitoring Scripts
â”‚   â”‚   â”œâ”€â”€ monitor_mediator.sh        â† Monitor mediator daemon
â”‚   â”‚   â”œâ”€â”€ monitor_vms.sh             â† Monitor VM activity
â”‚   â”‚   â”œâ”€â”€ log_collector.sh           â† Collect logs
â”‚   â”‚   â””â”€â”€ health_check.sh            â† System health check
â”‚   â”‚
â”‚   â””â”€â”€ Development Scripts
â”‚       â”œâ”€â”€ setup_dev_env.sh           â† Setup development environment
â”‚       â”œâ”€â”€ run_tests.sh               â† Run test suite
â”‚       â”œâ”€â”€ generate_docs.sh           â† Generate documentation
â”‚       â””â”€â”€ code_format.sh             â† Format code
â”‚
â””â”€â”€ ğŸ“¦ packages/ [TO CREATE]
    â”‚   Packaged releases
    â”‚
    â”œâ”€â”€ RPMs
    â”‚   â”œâ”€â”€ qemu-vgpu-4.2.1-1.el8.x86_64.rpm
    â”‚   â””â”€â”€ vgpu-guest-client-1.0-1.el8.x86_64.rpm
    â”‚
    â”œâ”€â”€ DEBs
    â”‚   â””â”€â”€ vgpu-guest-client_1.0-1_amd64.deb
    â”‚
    â”œâ”€â”€ Source Tarballs
    â”‚   â”œâ”€â”€ vgpu-stub-enhanced-1.0.tar.gz
    â”‚   â”œâ”€â”€ vgpu-guest-client-1.0.tar.gz
    â”‚   â””â”€â”€ vgpu-host-mediator-1.0.tar.gz
    â”‚
    â””â”€â”€ Checksums
        â””â”€â”€ SHA256SUMS

================================================================================
FILE COUNT ESTIMATES
================================================================================

Documentation:     13 files (âœ… 7 complete, â³ 6 pending)
vGPU Stub:        12 files (â³ all pending)
Guest Client:     25 files (â³ all pending)
Host Mediator:    20 files (â³ all pending)
Testing:          30 files (â³ all pending)
Additional Docs:  20 files (â³ all pending)
Scripts:          20 files (â³ all pending)
Packages:          5 files (â³ all pending)

TOTAL:           145 files
STATUS:          ~5% complete (documentation only)

================================================================================
SIZE ESTIMATES
================================================================================

Component                LOC (Lines of Code)   Docs (Pages)
-----------------------------------------------------------------
vGPU Stub Enhanced        500 lines            5 pages
Guest Client Library      800 lines            15 pages
Test Programs             600 lines            10 pages
Host Mediator Adapter     700 lines            12 pages
Testing Suite             400 lines            8 pages
Scripts                   500 lines            5 pages
Documentation             N/A                  50 pages
-----------------------------------------------------------------
TOTAL                     3,500 lines          105 pages

Current Status:           ~250 lines done      ~55 pages done
                         (7%)                  (52%)

================================================================================
IMPLEMENTATION PHASES
================================================================================

Phase 1: vgpu_stub_enhanced/
    Duration: 2 days
    Output: 12 files, ~500 LOC
    Dependencies: None
    
Phase 2: guest_client/
    Duration: 3 days
    Output: 25 files, ~1400 LOC
    Dependencies: Phase 1
    
Phase 3: host_mediator/
    Duration: 4 days
    Output: 20 files, ~700 LOC
    Dependencies: Mediator code provided
    
Phase 4: testing/
    Duration: 3 days
    Output: 30 files, ~400 LOC
    Dependencies: Phases 1-3
    
Phase 5: docs/
    Duration: 2 days
    Output: 20 files, ~50 pages
    Dependencies: Phases 1-4
    
Phase 6: scripts/ & packages/
    Duration: 2 days
    Output: 25 files, ~500 LOC
    Dependencies: All above

Total: 16 days, 145 files, ~3500 LOC, ~105 pages docs

================================================================================
QUICK NAVIGATION
================================================================================

Want to...                              Read this file
------------------------------------------------------------------------
Understand the project?                 â†’ README.md
Know next steps?                        â†’ READY_TO_PROCEED.md
See the full plan?                      â†’ IMPLEMENTATION_ROADMAP.md
Understand MMIO registers?              â†’ REGISTER_MAP_SPEC.md
See code changes needed?                â†’ VGPU_STUB_CHANGES.md
Understand directory structure?         â†’ DIRECTORY_STRUCTURE.txt (here)
Know what files exist?                  â†’ ls -lR step2_addtion/

Want to...                              Location
------------------------------------------------------------------------
Build QEMU with vGPU stub?              â†’ vgpu_stub_enhanced/build/
Write guest programs?                   â†’ guest_client/
Integrate with mediator?                â†’ host_mediator/
Run tests?                              â†’ testing/
Read API docs?                          â†’ docs/
Use helper scripts?                     â†’ scripts/

================================================================================
LEGEND
================================================================================

[EXISTS]        File/directory currently exists
[TO CREATE]     Will be created during implementation
âœ…              Complete/done
â³              Pending/not started
ğŸŸ¡              In progress
ğŸ”´              Blocked
ğŸ“„              Documentation file
ğŸ”§              Source code
ğŸ‘¥              Client/user-facing
ğŸ–¥ï¸              Server/host-facing
ğŸ§ª              Testing
ğŸ“š              Documentation collection
ğŸ› ï¸              Tools/utilities
ğŸ“¦              Packaged releases

================================================================================
NOTES
================================================================================

1. All paths are relative to: /home/david/Downloads/gpu/step2_addtion/

2. The structure is organized by component/concern:
   - vgpu_stub_enhanced/  : QEMU device code
   - guest_client/        : VM-side code
   - host_mediator/       : Host-side code
   - testing/             : All tests
   - docs/                : Documentation
   - scripts/             : Automation

3. Each subdirectory will have its own README.md explaining its contents

4. Build outputs (*.o, *.so, etc.) are not tracked, only source files

5. The structure supports both development and deployment:
   - Development: Use source files in place
   - Deployment: Use packages/ directory

6. Version control:
   - Consider git repository for source code
   - Tag releases for packages/

7. Dependencies tracked per component:
   - See IMPLEMENTATION_ROADMAP.md for details

8. This structure is extensible:
   - Easy to add new test cases
   - Easy to add new utilities
   - Easy to add new documentation

================================================================================
END OF DIRECTORY STRUCTURE
================================================================================

Last Updated: 2026-02-12
Status: Planning complete, ready for implementation
Next: Choose implementation option in READY_TO_PROCEED.md
